var E={exports:{}},d={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p;function g(){if(p)return d;p=1;var _=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(o,s,i){var r=null;if(i!==void 0&&(r=""+i),s.key!==void 0&&(r=""+s.key),"key"in s){i={};for(var n in s)n!=="key"&&(i[n]=s[n])}else i=s;return s=i.ref,{$$typeof:_,type:o,key:r,ref:s!==void 0?s:null,props:i}}return d.Fragment=e,d.jsx=t,d.jsxs=t,d}var S;function m(){return S||(S=1,E.exports=g()),E.exports}var y=m();const I={},f="vn",R={us:{name:"United States",auth0_domain:"vinfast-us-prod.us.auth0.com",auth0_client_id:"xhGY7XKDFSk1Q22rxidvwujfz0EPAbUP",auth0_audience:"https://vinfast-us-prod.us.auth0.com/api/v2/",api_base:"https://mobile.connected-car.vinfastauto.us"},eu:{name:"Europe",auth0_domain:"vinfast-eu-prod.eu.auth0.com",auth0_client_id:"dxxtNkkhsPWW78x6s1BWQlmuCfLQrkze",auth0_audience:"https://vinfast-eu-prod.eu.auth0.com/api/v2/",api_base:"https://mobile.connected-car.vinfastauto.eu"},vn:{name:"Vietnam",auth0_domain:"vin3s.au.auth0.com",auth0_client_id:"jE5xt50qC7oIh1f32qMzA6hGznIU5mgH",auth0_audience:"https://vin3s.au.auth0.com/api/v2/",api_base:"https://mobile.connected-car.vinfast.vn"}},C=["VEHICLE_STATUS_HV_BATTERY_SOC","VEHICLE_STATUS_LV_BATTERY_SOC","VEHICLE_STATUS_REMAINING_DISTANCE","VEHICLE_STATUS_ODOMETER","CHARGING_STATUS_CHARGING_STATUS","CHARGING_STATUS_CHARGING_REMAINING_TIME","CHARGE_CONTROL_CURRENT_TARGET_SOC","VEHICLE_STATUS_IGNITION_STATUS","VEHICLE_STATUS_GEAR_POSITION","VEHICLE_STATUS_VEHICLE_SPEED","VEHICLE_STATUS_HANDBRAKE_STATUS","VEHICLE_STATUS_AMBIENT_TEMPERATURE","CLIMATE_INFORMATION_DRIVER_TEMPERATURE","VEHICLE_STATUS_FRONT_LEFT_TIRE_PRESSURE","VEHICLE_STATUS_FRONT_RIGHT_TIRE_PRESSURE","VEHICLE_STATUS_REAR_LEFT_TIRE_PRESSURE","VEHICLE_STATUS_REAR_RIGHT_TIRE_PRESSURE","DOOR_AJAR_FRONT_LEFT_DOOR_STATUS","DOOR_AJAR_FRONT_RIGHT_DOOR_STATUS","DOOR_AJAR_REAR_LEFT_DOOR_STATUS","DOOR_AJAR_REAR_RIGHT_DOOR_STATUS","DOOR_TRUNK_DOOR_STATUS","REMOTE_CONTROL_DOOR_STATUS","REMOTE_CONTROL_BONNET_CONTROL_STATUS","REMOTE_CONTROL_WINDOW_STATUS","REMOTE_CONTROL_CHARGE_PORT_STATUS","VEHICLE_STATUS_FRONT_LEFT_TIRE_TEMPERATURE","VEHICLE_STATUS_FRONT_RIGHT_TIRE_TEMPERATURE","VEHICLE_STATUS_REAR_LEFT_TIRE_TEMPERATURE","VEHICLE_STATUS_REAR_RIGHT_TIRE_TEMPERATURE","PET_MODE_CONTROL_STATUS","CAMP_MODE_CONTROL_STATUS","VEHICLE_STATUS_LOCK_STATUS","CLIMATE_INFORMATION_PASSENGER_TEMPERATURE","CLIMATE_INFORMATION_DRIVER_AIR_BLOW_LEVEL","LOCATION_LATITUDE","LOCATION_LONGITUDE","VEHICLE_BEARING_DEGREE","BMS_STATUS_STATE_OF_HEALTH","BMS_STATUS_NOMINAL_CAPACITY_OF_THE_BATTERY_PACK","BMS_STATUS_BATTERY_TYPE","BMS_STATUS_BATTERY_SERIAL_NUMBER","BMS_STATUS_BATTERY_DECODED_MANUFACTURE_DATE","VINFAST_VEHICLE_IDENTIFIER_VEHICLE_MANUFACTURER","FIRMWARE_UPDATE_CURRENT_PKG_VERSION","VERSION_INFO_TBOX_SOFTWARE_VERSION","BMS_STATUS_THERMAL_RUNAWAY_WARNING","CCARSERVICE_OBJECT_BOOKING_SERVICE_STATUS"],v={vn:{endpoint:"prod.iot.connected-car.vinfast.vn",region:"ap-southeast-1",cognitoPoolId:"ap-southeast-1:c6537cdf-92dd-4b1f-99a8-9826f153142a",cognitoLoginProvider:"vin3s.au.auth0.com",heartbeatInterval:12e4,keepAlive:300}};(()=>{const _=[],e=typeof import.meta<"u"&&I?.VITE_BACKUP_PROXY_URL;return e&&_.push({baseUrl:e.replace(/\/$/,""),pathPrefix:"/api/vf-proxy"}),_})();const u="vf_session",w=300*1e3;class O{constructor(){this.region=f,this.regionConfig=R[f],this.vin=null,this.userId=null,this.rememberMe=!1,this.tokenExpiresAt=0,this._refreshPromise=null,this.isLoggedIn=!1,this.restoreSession()}setRegion(e){this.region=e,this.regionConfig=R[e]||R[f]}setCookie(e,t,o){if(typeof document>"u")return;let s="";const i=window.location.protocol==="https:";if(o){const r=new Date;r.setTime(r.getTime()+o*24*60*60*1e3),s="; expires="+r.toUTCString()}document.cookie=e+"="+(encodeURIComponent(JSON.stringify(t))||"")+s+`; path=/; SameSite=Lax${i?"; Secure":""}`}_readSessionFromStorage(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(u);if(!e)return null;const t=JSON.parse(e);return!t||typeof t!="object"||t.expiresAt&&t.expiresAt<=Date.now()?(window.localStorage.removeItem(u),null):t}catch{try{window.localStorage.removeItem(u)}catch{}return null}}_writeSessionToStorage(e){if(!(typeof window>"u"))try{if(!e){window.localStorage.removeItem(u);return}window.localStorage.setItem(u,JSON.stringify(e))}catch{}}getCookie(e){if(typeof document>"u")return null;const t=e+"=",o=document.cookie.split(";");for(let s=0;s<o.length;s++){let i=o[s];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(t)===0)try{return JSON.parse(decodeURIComponent(i.substring(t.length,i.length)))}catch{return null}}return null}deleteCookie(e){typeof document>"u"||(document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")}saveSession(){if(!(typeof window>"u"))try{const e=this.rememberMe?2592e6:432e5,t={vin:this.vin,userId:this.userId,region:this.region,rememberMe:this.rememberMe,tokenExpiresAt:this.tokenExpiresAt||0,timestamp:Date.now(),expiresAt:Date.now()+e};this.setCookie("vf_session",t,this.rememberMe?30:null),this._writeSessionToStorage(t)}catch(e){console.error("Failed to save session",e)}}restoreSession(){if(!(typeof window>"u"))try{const e=this.getCookie(u)||this._readSessionFromStorage();if(e){if(this.vin=e.vin,this.userId=e.userId,this.rememberMe=!!e.rememberMe,this.tokenExpiresAt=e.tokenExpiresAt||0,e.expiresAt&&e.expiresAt<=Date.now()){this.clearSession();return}e.region&&this.setRegion(e.region),this.isLoggedIn=!0;const t=Date.now();(!this.tokenExpiresAt||this.tokenExpiresAt<=t+w)&&this.refreshAccessToken().catch(s=>console.warn("Background refresh failed",s))}else this.isLoggedIn=!1}catch(e){console.error("Failed to restore session",e)}}clearSession(){typeof window>"u"||(this.deleteCookie("vf_session"),this._writeSessionToStorage(null),this.vin=null,this.userId=null,this.rememberMe=!1,this.tokenExpiresAt=0,this.isLoggedIn=!1)}_getHeaders(e=void 0){const t={"Content-Type":"application/json",Accept:"application/json","x-service-name":"CAPP","x-app-version":"1.10.3","x-device-platform":"android","x-device-family":"VFDashboard","x-device-os-version":"Community","x-device-locale":"vi-VN","x-timezone":"Asia/Ho_Chi_Minh","x-device-identifier":"vfdashboard-community-edition"},o=e??this.vin;return o&&(t["x-vin-code"]=o),this.userId&&(t["x-player-identifier"]=this.userId),t}async authenticate(e,t,o="vn",s=!1){this.setRegion(o),this.rememberMe=s;const i="/api/login",r={email:e,password:t,region:this.region,rememberMe:this.rememberMe};try{const n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),c=await n.json();if(c._authLog){const a=c._authLog;if(a.length>1||n.status===429){const l=n.status===429?"üî¥":a.length>1?"üü°":"‚úì";console.group(`${l} Auth0 login ‚Äî ${a.length} attempt(s), final: ${n.status}`),a.forEach(h=>{const T=h.status===429?"color:#ef4444":h.status<400?"color:#4ade80":"color:#f59e0b",A=h.status!==429&&h.status<400?"‚úì":"‚úó";console.log(`%c  ${A} ${h.via}%c ‚Üí ${h.status} (${h.ms||0}ms)`,T+";font-weight:bold","color:#9ca3af")}),console.groupEnd()}else a.length===1&&console.log(`%c‚úì Auth0 login%c ‚Üí direct (${a[0]?.ms||0}ms)`,"color:#4ade80;font-weight:bold","color:#9ca3af")}if(!n.ok){let a="An unexpected error occurred. Please try again.";throw c&&c.message&&(a=c.message),n.status===401?a="Incorrect email or password. Please check your credentials.":n.status===403?a="Access denied. Your account may be locked or restricted.":n.status===429?a="Too many attempts. Please try again later.":n.status>=500&&(a="VinFast server error. Please try again later."),new Error(a)}return c.tokenExpiresAt&&(this.tokenExpiresAt=c.tokenExpiresAt),this.isLoggedIn=!0,this.saveSession(),{success:!0}}catch(n){throw console.error("Auth Error:",n),n}}async refreshAccessToken(){if(this._refreshPromise)return this._refreshPromise;this._refreshPromise=this._doRefresh();try{return await this._refreshPromise}finally{this._refreshPromise=null}}async _doRefresh(){try{const e=await fetch("/api/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({region:this.region,rememberMe:this.rememberMe})});if(e.ok){const t=await e.json();return t.tokenExpiresAt&&(this.tokenExpiresAt=t.tokenExpiresAt),this.saveSession(),!0}else return!1}catch(e){return console.error("Refresh token error:",e),!1}}async _fetchWithRetry(e,t={}){t.headers=t.headers||this._getHeaders();let o=await fetch(e,t);if(this._logProxyRoute(e,o),o.status===401)if(console.warn("Received 401. Trying to refresh token..."),await this.refreshAccessToken())o=await fetch(e,t),this._logProxyRoute(e,o);else throw this.clearSession(),window.location.href="/login",new Error("Session expired");return o}_logProxyRoute(e,t){try{const o=t.headers.get("x-proxy-route"),s=t.headers.get("x-proxy-log");if(!o&&!s)return;const i=e.replace(/\?.*$/,"").replace("/api/proxy/",""),r=t.status;if(s){const n=JSON.parse(s);n.length<=1&&r<400?console.log(`%c‚úì ${i}%c ‚Üí direct (${n[0]?.ms||0}ms)`,"color:#4ade80;font-weight:bold","color:#9ca3af"):(console.group(`${r===429?"üî¥":"üü°"} ${i} ‚Äî ${n.length} attempt(s), final: ${r}`),n.forEach((a,l)=>{const h=a.status===429?"color:#ef4444":a.status<400?"color:#4ade80":"color:#f59e0b",T=l===n.length-1&&a.status!==429?"‚úì":"‚úó";console.log(`%c  ${T} ${a.via}%c ‚Üí ${a.status} (${a.ms||0}ms)`,h+";font-weight:bold","color:#9ca3af")}),console.groupEnd())}else o&&console.log(`[Proxy] ${i} via ${o} ‚Üí ${r}`)}catch{}}async getVehicles(){const t=`/api/proxy/ccarusermgnt/api/v1/user-vehicle?region=${this.region}`,o=await this._fetchWithRetry(t);if(!o.ok)throw new Error("Failed to fetch vehicles");const s=await o.json();return s.data&&s.data.length>0&&(this.vin=s.data[0].vinCode,this.userId=s.data[0].userId,this.saveSession()),s.data||[]}async getUserProfile(){const e=`/api/user?region=${this.region}`,t=await this._fetchWithRetry(e);if(!t.ok)throw new Error(`Failed to fetch user profile: ${t.status}`);return await t.json()}async getAliases(e,t="1.0"){if(e&&(this.vin=e),!this.vin)throw new Error("VIN is required");const s=`/api/proxy/modelmgmt/api/v2/vehicle-model/mobile-app/vehicle/get-alias?region=${this.region}&version=${t}`,i=await this._fetchWithRetry(s);if(!i.ok)throw new Error("Failed to fetch aliases");const r=await i.json();let n=[];if(r.data&&r.data.resources?n=r.data.resources:r.data&&r.data.data&&r.data.data.resources?n=r.data.data.resources:Array.isArray(r.data)?n=r.data:Array.isArray(r.resources)?n=r.resources:Array.isArray(r)&&(n=r),n.length===0&&(console.warn("getAliases: No resources found in response:",r),r.code===401e3||r.message?.includes("expired")))throw this.clearSession(),window.location.href="/login",new Error("Session expired (API Code 401000)");return n}async registerResources(e,t){if(!e||!t||t.length===0)return;const s=`/api/proxy/${`ccaraccessmgmt/api/v1/telemetry/${e}/list_resource`}?region=${this.region}`;try{const i=await this._fetchWithRetry(s,{method:"POST",body:JSON.stringify(t)});if(!i.ok){const r=await i.text();console.warn("registerResources failed:",i.status,r||"no body");return}console.log(`[Register] Core resources registered for ${e} (${t.length} aliases)`)}catch(i){console.warn("registerResources failed:",i)}}async searchChargingStations(e,t,o=!1){const i=`/api/proxy/ccarcharging/api/v1/stations/search?region=${this.region}`,r=await this._fetchWithRetry(i,{method:"POST",body:JSON.stringify({latitude:e,longitude:t,excludeFavorite:o})});if(!r.ok)throw new Error("Failed to search charging stations");const n=await r.json();return n.data||n}async getChargingHistory(e=0,t=20,o=null){const s=o??this.vin;if(!s)throw new Error("VIN is required");const r=`/api/proxy/ccarcharging/api/v1/charging-sessions/search?region=${this.region}&page=${e}&size=${t}`,n=await this._fetchWithRetry(r,{method:"POST",headers:this._getHeaders(s),body:JSON.stringify({orderStatus:[3,5,7]})});if(!n.ok)throw new Error("Failed to fetch charging history");return await n.json()}async fetchLocationName(e,t){if(e==null||t===null||t===void 0)return null;try{const o=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`,s=await fetch(o,{headers:{"User-Agent":"VFDashboard/2.0"}});if(s.ok){const r=(await s.json()).address||{},n=l=>l&&l.replace(/^(Th√†nh ph·ªë|T·ªânh|Qu·∫≠n|Huy·ªán|X√£|Ph∆∞·ªùng)\s+/gi,"").trim(),c=r.city_district||r.district||r.county,a=r.city||r.town||r.village||r.state||r.province;return{location_address:[n(c),n(a),(r.country_code||"VN").toUpperCase()].filter(Boolean).join(", "),weather_address:[n(a),(r.country_code||"VN").toUpperCase()].filter(Boolean).join(", ")}}}catch(o){console.warn("Location fetch failed",o)}return null}async fetchWeather(e,t){if(e==null||t===null||t===void 0)return null;try{const o=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&current_weather=true`,s=await fetch(o);if(s.ok)return(await s.json()).current_weather}catch(o){console.warn("Weather fetch failed",o)}return null}async getKnownAliases(e,t){try{const o=new URLSearchParams({model:e});t&&o.set("year",String(t));const s=await fetch(`/api/known-aliases?${o}`);return s.ok?await s.json():{aliases:[],source:"error"}}catch(o){return console.warn("getKnownAliases failed:",o),{aliases:[],source:"error"}}}async reportKnownAliases(e,t,o,s){try{const i=await fetch("/api/known-aliases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e,year:t,aliases:o,discoveredBy:s})});return i.ok?await i.json():{success:!1}}catch(i){return console.warn("reportKnownAliases failed:",i),{success:!1}}}}const x=new O;export{C,f as D,v as M,x as a,y as j};
